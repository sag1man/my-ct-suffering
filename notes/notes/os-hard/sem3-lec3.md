
---

[[index|Конспекты]] / [[notes/os-hard/index|Операционные системы (hard)]] / РАЗДЕЛ НЕ ГОТОВ

---

## Пространства имен и контейнеры
Были позаимствованы из Plan 9, впервые появились в linux в 2.4.19 в 2002. Контейнеры постоянно используются для виртуализации.

##### Определения
**Контейнер** - легковесная форма ВМ, можно их использовать на оборудовании без поддержки виртуацизации
- Примеры контейнеров это docker и lxc.

**Namespace** - механизм позволяющий иметь контейнеры в ядре ос
- Namespace присутвует по умолчанию

Доступ к процессу проходит по struct task_struct

Изменение контекста

![[Pasted image 20251003155724.png]]

Схема в упрощенном виде иллюстирует, как меняется процесс на ядре.

Концепция изменения состояний процесса - любая задача меняется.

### Блокирование текущей задачи
Блокирование - остановка исполнения задачи (может быть прерываемым и не прерываемым), в его процессе нужно выполнять переключение контекста, соотвественно регистры сохраняются в контексте

### Пробуждение задачи
Нужно убрать её из очереди ожидания, переключить её на task_ready, после этого она помещается в очередь планировщика, планировщик уже оттуда её будет брать для исполнения. Если система многоядерная или многопроцессорная, если очереди на разных ядрах, их нужно балансировать.

### Вытеснение задач
Задача может быть вытеснена, если есть более важные процессы. Ядро может быть вытясняющим и нет. Если оно вытесняющее, проверяется, использовал ли процесс всё выделенное время, тогда ему ставился флаг и задача не вытесняется. Если ядро вытесняемое, то даже если текущая задача исполняет сискол, то всё равно может быть вытеснена, для этого есть специальные запрещающие вызов примитивы. Например spin_lock проверяет бескончено проверку переменной (об это позже).

### Process context
Контекст процесса - информация о процессе, при сисколе ядро имеет доступ к контекту 

### Interrupts
Прерывания - событие, которое служит для передачи информации от устройства к текущему процессу, во время него процесс останавливается и происходят действия в зависимости от прерывания

#### Делятся на 2 категории в зависимости от источника 
Синхронные - происходят от попытки исполнить инструкцию, и не синхронные - от внешнего события

ещё делятся ещё на маскируемые - те которые можно отложить или проигнорировать, и немаксируемые

Синхронные прерывания обычно называются исключениями (exceptions), детектятся самим процессором во время исполнения (например деление на 0)

Исключения делятся на:
- Faults (Тип исключительной ситуации, которая может быть исправлена, addr_ptr это будет та же инструкция)
- Traps (Тип, который обнаруживается уже после исполнения, в таком случае сохраняемый addr_ptr это будет следующая инструкция)
- Aborts (-)

Аппаратные концепции прерываний
PIC (Programmable Interrupt controller) - отдельная часть схемы, связанная с процессором двумя контактами ( упрощенная модель). PIC сам обрабатывает прерывания, может обрабатывать паралелльные, и упорядоченно посылать их процессору. 